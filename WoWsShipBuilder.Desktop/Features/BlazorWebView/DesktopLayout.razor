@using WoWsShipBuilder.Infrastructure.ApplicationTheme

@inherits LayoutComponentBase
@implements IDisposable

@inject ThemeManager ThemeManager

<MudThemeProvider Theme="@theme" IsDarkMode="true"/>
<MudDialogProvider/>
<MudSnackbarProvider/>

<MudLayout>
    <DesktopTopMenu/>
    <MudMainContent Class="px-2">
        <CascadingValue Name="SettingsInitialized" Value="@settingsInitialized">
            @Body
        </CascadingValue>
    </MudMainContent>
</MudLayout>

@code
{
    private readonly bool settingsInitialized = true;

    private MudTheme theme = default!;

    protected override void OnInitialized()
    {
        base.OnInitialized();
        theme = ThemeManager.AppTheme;
        ThemeManager.ThemeChanged += UpdateTheme;
    }

    private void UpdateTheme(object? sender, MudTheme newTheme)
    {
        theme = newTheme;
        StateHasChanged();
    }

    public void Dispose()
    {
        ThemeManager.ThemeChanged -= UpdateTheme;
    }
}
